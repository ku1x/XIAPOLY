<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Polytope XIa</title>
  <meta name="viewport" content="width=device-width">
  <!--<link rel="stylesheet" type="text/css" href="style.css"> -->
  <style>
 

*{
    margin: 0px;
    padding: 0px;
}

h2 {
  font-size: 1.2em;
  white-space: nowrap;
}


h2 span {
  white-space: nowrap;
  display: inline-block;
}

  #content h1::after,
  #content h2::after {
  content: "";
  display: block;
  height: 2px;
  background-color: black;
  margin-top: 5px;
}


  </style>
</head>

<body>
  <div id="bg" style="height: 100vh; width: 100vw">
  <div id="content">
    <h2>Polytope XIa</h2>
    <h2> <span id="title">title</span></h2>
      <h2> <span id="artist">artist</span></h2>
        <h2> <span id="status">Disconnected</span></h2>
        <!-- <h2>Messages:</h2>
        <ul id="messages"></ul> -->
  </div>
  <div class="footer">
    <div class="zigzag"></div>
  </div>
  </div>
  
</body>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const status = document.getElementById('status');
    const messages = document.getElementById('messages');

    
    const title = document.querySelector("#title");
    const artist = document.querySelector("#artist");
    


    const socket = io({
      // Socket.IO options
    });

    socket.on('connect', () => {
      status.innerText = 'Connected';
      //appendMessage(`status: connected`);
    });
  /*
    socket.on('connect_error', (err) => {
      appendMessage(`event: connect_error | reason: ${err.message}`);
    });

    socket.on('disconnect', (reason) => {
      status.innerText = 'Disconnected';
      appendMessage(`event: disconnect | reason: ${reason}`);
    }); */




    let time = 1000;
    var color = 'white' ;
    let intervalTime ;
    let currentTime = intervalTime;
    const bg = document.getElementById('bg');
    bg.style.backgroundColor = color;
    let t;
    let isBgBlack = false;
    
    const blink = () => { // 修改intervalTime的初始值
      bg.style.backgroundColor = 'black';
      clearInterval(t);
      isBgBlack = true;
      t = setInterval(() => {
        if (isBgBlack) {
          bg.style.backgroundColor = color;
        } else {
          bg.style.backgroundColor = 'black';
        }
        isBgBlack = !isBgBlack;
        console.log(currentTime/2);
        console.log(color);
      }, currentTime/2); 
      setTimeout(() => {
        clearInterval(t);
        blink();
        intervalTime = currentTime;
        currentTime = time;
      }, intervalTime);
    }

    
    if(time==0){
      bg.style.backgroundColor = 'black';
    }else if(time>=5000){
      bg.style.backgroundColor = 'white';
    }else blink();
    

    socket.on('osc', (oscSig) => {
      time = oscSig.intensity;
      //color = oscSig.colour;
    });
    
    setInterval(() => {
      if (currentTime !== time) {
        currentTime = time;
      }
    }, intervalTime);
    

    socket.on('text', (msg) => {
      //const mytext = document.getElementById('mytext');
      title.innerHTML = msg.title;
      artist.textContent = msg.detail;
    })
  </script>
</html>